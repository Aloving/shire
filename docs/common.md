# Shire

Приложение по учету финансов:

## Встречающееся пометки

(?) - Под вопросом, обсудить
(!) - Обратить внимание

## Функционал

### Основной функционал
- Добавлять доходы;
- Добавлять расходы;
- Показывать настоящий баланс;
- Статистика по периодам;
- Персональные аккаунты (регистрация и авторизация);

### Дополнительный функционал
- Актуальная статистика по дням;

## Общая информация

- Проект направление на получения опыта в проектировании и опыта в react;
- Проект не большой, представляет из себя веб приложение;
- Использование полного стека js;
- Максимально отзывчивый интерфейс;
- Максимальная отказоустойчивость;
- Общая структура проекта;

Не сколько сущностей которые можно выделить:
- Запись, запись дохода / расхода;
- Баланс (Общий, доходы, расходы);

Будет такая сущность как запись, краеугольный камень всего приложения, записи будут:
- Добавляться;
- Удаляться;
- Собираться в периоды;
- Записи можно будет получать;
- Записи будут влиять на балансы;
- Приложение не будет предоставлять дополнительный функционал по валюте;

Балансы:
- Настоящий баланс доходов (будет отображать положительный баланс денег);
- Настоящий баланс расходов (сколько было потрачено сумарно);
- Общий баланс (Баланс за вычетом доходов и расходов);

Записи должны влиять только на баланс того периода в котором записаны! (!)
При получении балансов по определенным периодам, необходимо брать расходы и доходы за этот период и на основе них отображать баланс;

## По архитектуре

### Backend

Приложение использует стандартный подход MVC, с роутами и контроллерами:
Пользователь со стороны клиента будет "Стучаться" по предоставленным роутам (В дальнейшем ручки), получать с них нужные данные и таким образом обеспечивать функционал веб - приложения.

Примерно следующим образом это будет выглядить:
Пользователь дергает ручку =>

Приложение на node.js получает запрос =>

Уведомляет об этом контроллер =>

Контроллер проводит манипуляции с моделью =>

Отвечает пользователю этими данными;

Подробное описание подхода по ссылке ниже:

https://developer.mozilla.org/en-US/docs/Learn/Server-side/Express_Nodejs/routes

Роуты:
https://github.com/Aloving/shire/blob/master/routes.md

#### Инструменты и подходы и их обоснования
- Koa.js
  Можно использовать и альтернативный вариант express.js, не сколько пунктов за koa.js
  - Сильный механизм middleware, которые могут сильно пригодиться и облегчить работу;
  - Общее знакомство с koa.js, что может пригодиться в будущем;

- Испольнование стандартного подхода MVC
  Подход полностью покрывает нужный функционал, данный подход можно использовать как с небольшими приложениями, так и с большими. MVC хорошо подходит для веб приложений, легко понимаем, легко читаем, etc...

- MongoDB (mongoose.js);
  Нет каких-то точных обоснований этому, используется потому-что имеется опыт с этим;

#### Роуты
В качестве роутера будет использоваться [koa.js router](https://github.com/alexmingoia/koa-router)
Механизм роутов понятен и прозрачен, приложение использует самый стандартный подход роутов, работает следующим образом:

Пользователь "дергает" роут, роут уведмоляет об этом контроллер или метод контроллера, с контроллера возвращается ответ;

Для роутов будут использоваться следующие методы:

Метод  | Назначение
-------- | ---
del | Удаление
put | Добавление
patch | Обновление
get | Получение
post | Может использоваться в тех ситуациях когда не один из методов выше не подошел

#### Контроллеры
> **BaseControl:**

> Базовый контроллер, представляет из себя класс с базовым набором методов которым обладает каждый контроллер,
> Базовы контроллер подходит как для наследования так и для создания инстансов;

Примерная структура BaseController:

```javascript
class BaseController {
  validate(){}
}
```

> **CRUD Controller:**

> Контроллер который представляет из себя что-то вроде абстрактного класса;
> CRUD расширяет BaseControl и имеет все теже мтеоды что остальные контроллеры;
> Достаточно спорно, является ли в этом случае класс абстрактным;
> CRUD контроллер описывает функционал: Create, Read, Update, Delete
> Не содержит собственной реализации этих методов;

Примерная структура CRUD Controller:

```javascript
class CRUDController extends BaseController {
  create(){}
  read(){}
  update(){}
  delete(){}
}
```

> **Router Controllers:**

> Контроллер который будет создавать отдель под каждый роут или какую-то бизнес задачу;
> Например ExpensesController обрабатывает операции по созданию, получению, удалению, обновлению
> записей связанных с затратами в своих методах;
> Контроллер в некоторых случаях, когда это необходимо, экстендится от CRUD Controller;

#### Модели
Модели будут представлять слой взаимодействия с данными.
Возможно будет иметь смысл написать слой абстракции поверх моделей (!);

> **Operation(Запись):**

Модель по взаимодействию с данными записей;
Главной требованием нужно выделить следующее:
Должен быть реализован функционал получения за период, как с сумированией всех записей в одну запись, так и записей отдельно;
Создание / Удаление / Обновление должно влиять на настоящие балансы;

Модель операции имеет следующие поля:
```
operationType: String; // Наименование операции (Expenses / Incomes);
title: String;         // Название
amount: Number;        // Сумма
date: Date;            // Дата создания
```

> **Balance:**

Модель которые будет высчитывать балансы и отдавать только данные.
Из важного:
Необходимо предоставить возможность получения балансов за период.
Записи должны влиять только на баланс в период когда они записаны.
Необходимо предоставить функционал баланса "За все время", данный баланс будет отображать настоящий баланс за все время.
Сюда же входит общий баланс по годам, месяцам и общая оценка, примерно так это должно выглядить

| month | balance |
| -------- | -----:|
| Январь | 30000 |
| Февраль | -120 |
| Март | 470 |
| Всего | 30350|

Модель операции имеет следующие поля:
```
IncomesBalance: Number;   // Баланс доходов
ExpensesBalance: Number;  // Баланс расходов
CurrentBalance: Number    // Настоящий баланс
```

#### Форматы положительного ответа / отрицательного ответа
Формат ответа приведен к одному виду, чтобы знать точно какой ответ ожидать с сервера, ответы приведены к одному формату и выглядят следующим образом, положительный ответ:
```json
{
  success: true,
  data
}
```

Отрицательный ответ:
```json
{
  success: false,
  err
}
```
========================

Что еще стоит рассмотреть:
- Авторизация, делать авторизацию собственными силами или использовать готовые решения?;
- Позже добавить точные Mongoose модели
